<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Login - Purple Auto Spa</title>
    
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- BACKGROUND UPDATE (Greyish White) --- */
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #F0F2F5; /* Professional Grey */
        }
        
        .login-container {
            background: #F0F2F5 !important; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh;
            flex-direction: column;
            position: relative;
        }

        .login-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); /* Soft Shadow */
            text-align: center;
            width: 85%;
            max-width: 350px;
        }

        .footer-credit {
            position: absolute; bottom: 20px; 
            color: #999; 
            font-size: 11px;
        }
    </style>
</head>
<body>

    <div class="login-container">
        
        <div class="login-card">
            <img src="assets/logo.png" alt="Purple Auto Spa" class="login-logo">
            
            <h2 style="color:#6A1B9A; font-weight:700; margin-bottom:5px;">Purple Auto Spa</h2>
            <p style="color:#777; font-size:12px; margin-bottom:30px;">Shine and Protect</p>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <input type="number" id="mobile" class="form-control" placeholder="Mobile Number" required
                           oninput="if(this.value.length > 10) this.value = this.value.slice(0, 10)">
                </div>
                
                <div class="form-group">
                    <input type="password" id="password" class="form-control" placeholder="Password" required>
                </div>

                <button type="submit" class="btn-main" id="loginBtn">
                    Login Securely <i class="fas fa-arrow-right"></i>
                </button>
            </form>
        </div>

        <div class="footer-credit">Team Purple Greetings</div>
    </div>

    <script src="assets/js/config.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="assets/js/api.js"></script>
    <script src="assets/js/auth.js"></script>

    <script>
        // --- 1. NEW AUTH CHECK (Auto Redirect) ---
        checkAlreadyLogin();

        // --- 2. SERVICE WORKER REGISTRATION (ENABLED) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker Registered!', reg.scope))
                    .catch(err => console.log('Service Worker Fail:', err));
            });
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const mobile = document.getElementById('mobile').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('loginBtn');

            // UI Loading State
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
            btn.disabled = true;

            // Call API
            const response = await apiRequest('login', { mobile, password });

            // Handle Response
            if (response.status === 'success') {
                showToast("Login Successful!", "success");
                
                // Save Data
                localStorage.setItem('userName', response.user.name); 
                localStorage.setItem('userRole', response.user.role);
                
                // NEW: Save User ID (Zaroori hai My Space ke liye)
                if(response.user.id) {
                    localStorage.setItem('userId', response.user.id);
                }

                setTimeout(() => {
                    handleLoginSuccess(response.user.role);
                }, 1000);
            } else {
                showToast(response.message || "Login Failed", "error");
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
